rules_version = '2';

// Documentação de Regras do Storage: https://firebase.google.com/docs/storage/security
service firebase.storage {
  match /b/{bucket}/o {
    // Apenas usuários autenticados podem acessar o diretório de suas contas.
    // O accountId no caminho DEVE corresponder ao accountId associado ao usuário.
    match /accounts/{accountId}/{allPaths=**} {
      allow read, write: if request.auth != null && 
                           get(/databases/(default)/documents/accounts/$(accountId)).data.members.hasAny([request.auth.uid]);
    }
  }
}
